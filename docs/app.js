(()=>{"use strict";var t=window.location.search.indexOf("debug")>0,e=document.getElementById("canvas"),r=e.getContext("2d"),n=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}],i={state:"paused",width:0,height:0,wormWidth:0,maxWormLength:0,worm:[],heading:0,speed:0,test:null,points:0,level:0,tick:0},o=function(t){var e=t.x,r=t.y;return function(t){var n=t.x,i=t.y,o=e-n,a=r-i;return Math.sqrt(o*o+a*a)}},a=function(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)},u=function(t,e,r){var n=(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y);return 0===n?0:n>0?1:2},s=function(){var t,e,r,n,a,u,s,f,h=[],c=3+Math.round(3*Math.random()),d=(e=i.width,r=i.height,n=i.worm,a=i.wormWidth,u=3*a,s=[n[0]],f=function(t){var e=o(t);return s.every((function(t){return e(t)>u}))},function(){for(;;){var t={x:Math.random()*(e-4*a)+2*a,y:Math.random()*(r-4*a)+2*a};if(f(t))return s.push(t),t}}),l=1+Math.floor(5*Math.random()),v=1+Math.floor(5*Math.random()),m=l+v,x=(t=m,function(){for(;;){var e=1+Math.floor(10*Math.random());if(e!==t)return e}});h.push({name:m.toString(10),correct:!0,position:d()});for(var g=0;g<c;g++)h.push({name:x().toString(10),correct:!1,position:d()});return{question:l+" + "+v,answer:""+m,created:i.tick,options:h}},f=2*Math.PI,h=function(t,e,n){return r.fillText(n,t-.5*function(t){return r.measureText(t).width}(n),e)},c=function(t){r.save(),r.font="32px PressStart",r.textBaseline="hanging",r.fillStyle="rgba(192, 192, 192, 192)",h(.5*i.width,i.height/2,t),r.restore()},d=function(){var e,n,o=i.width,a=i.height,u=i.state;switch(r.clearRect(0,0,o,a),function(){r.save(),r.lineJoin="round",r.lineCap="round",r.lineWidth=i.wormWidth,r.strokeStyle="run"===i.state?"#ff00ff":"#770077",r.beginPath();var t=i.worm,e=t[0];e&&r.moveTo(e.x,e.y);for(var n=1;n<t.length;n++){var o=t[n],a=o.x,u=o.y;r.lineTo(a,u)}r.stroke(),r.restore()}(),e=i.wormWidth,n=i.points,r.save(),r.font=(.6*e).toFixed(1)+"px PressStart",r.textBaseline="middle",r.fillStyle="run"===i.state?"#50ff50":"#207720",r.fillText("points: "+n,e,e),r.restore(),u){case"run":!function(){var t=i.test,e=i.wormWidth,n=i.width;t&&(r.save(),r.font=(.6*e).toFixed(1)+"px PressStart",r.textBaseline="middle",r.fillStyle="run"===i.state?"#ffffff":"#777777",h(.5*n,e,t.question),r.fillStyle="run"===i.state?"#ffffff":"#777777",r.strokeStyle="run"===i.state?"#ffffff":"#777777",r.lineWidth=2,t.options.forEach((function(t){var e=t.name,n=t.position,o=n.x,a=n.y,u=.5*r.measureText(e).width;r.fillText(e,o-u,a),r.beginPath(),r.arc(o,a,i.wormWidth,0,f,!1),r.stroke()})),r.restore())}();break;case"paused":c("paused");break;case"game-over":c("game over")}t&&function(){var t=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,i++)n[i]=o[a];return n}(["state:    "+i.state,"speed:    "+i.speed,"length:   "+i.maxWormLength,"worm-w:   "+i.wormWidth.toFixed(1)],i.worm.map((function(t,e){var r=t.x,n=t.y;return(0===e?"worm:    ":"         ")+" ["+e+"] "+r.toFixed(0)+" : "+n.toFixed(0)}))),e=40;r.save(),r.font="16px courier",r.textBaseline="hanging",r.fillStyle="rgba(128, 128, 128, 128)";for(var n=0,o=t;n<o.length;n++){var a=o[n];r.fillText(a,20,e),e+=18}r.restore()}()},l=function(t){var e=new Audio("sounds/"+t+".mp3");return function(){e.play().catch((function(t){return console.error(t)}))}},v=l("crash"),m=l("squeak"),x=l("chaching"),g=function(){return(g=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},w=function(){var t=.5*i.width,e=.5*i.height;i.state="run",i.maxWormLength=300,i.worm=[{x:t,y:e},{x:t,y:e}],i.heading=0,i.speed=.05,i.test=s(),i.points=0,i.level=0,i.tick=0},y=function(t){"run"===i.state&&(i.heading=function(t,e){var r=t+e;return r<0?3:r>3?0:r}(i.heading,t),i.worm.unshift(g({},i.worm[0])))},p={run:function(){return i.state="paused"},paused:function(){return i.state="run"},"game-over":function(){return w()}};document.addEventListener("keydown",(function(e){var r=e.code,n=e.repeat;if(!n)switch(r){case"ArrowRight":return y(1);case"ArrowLeft":return y(-1);case"Space":return p[i.state]();case"KeyD":return t=!t;default:console.log("key: "+r+" ("+n+")")}}));var M=function(){var t=e.clientWidth,r=e.clientHeight;e.width=t,e.height=r,i.width=t,i.height=r,i.wormWidth=.02*t,"run"!==i.state&&d()};window.addEventListener("resize",M),M(),e.addEventListener("touchstart",(function(t){var e=i.state,r=i.width,n=.3*r,o=.7*r;if(t.preventDefault(),"run"===e){var a=t.touches[0],u=null==a?void 0:a.clientX;if(u<n)return y(-1);if(u>o)return y(1)}return p[e]()}));var W=function(t){0===i.tick&&(i.tick=t),"run"===i.state&&function(t){var e=t-i.tick;i.tick=t,function(t){var e=i.worm,r=n[i.heading],o=i.speed,s=e[0],f=s.x,h=s.y,c=i.wormWidth,d=c/2,l=i.maxWormLength,m=0,x=f+r.x*o*t,g=h+r.y*o*t;if(s.x=x,s.y=g,x<d||x>i.width-d||g<d||g>i.height-d)return v(),void(i.state="game-over");for(var w=e[0],y=e[1],p=function(t,e){return function(r,n){var i=u(t,e,r),o=u(t,e,n),s=u(r,n,t),f=u(r,n,e);return i!==o&&s!==f||!(0!==i||!a(t,r,e))||!(0!==o||!a(t,n,e))||!(0!==s||!a(r,t,n))||!(0!==f||!a(r,e,n))}}({x:w.x+r.x*c,y:w.y+r.y*c},y),M=3;M<e.length;M++)if(p(e[M-1],e[M]))return v(),void(i.state="game-over");for(M=1;M<e.length;M++){var W=e[M],k=W.x,S=W.y,b=x-k,L=g-S;if((m+=Math.abs(b)+Math.abs(L))>l){var T=l-m;0!==b&&(W.x+=T*(b>0?-1:1)),0!==L&&(W.y+=T*(L>0?-1:1)),e.splice(M+1);break}x=k,g=S}}(e),function(t){var e=i.wormWidth,r=i.test,n=i.worm;if(r){var a,u,f=r.options,h=o(n[0]),c=1.5*e,d=f.findIndex((function(t){var e=t.position;return h(e)<c})),l=f[d];l&&(l.correct?(x(),i.points+=1,i.speed*=1.15,i.maxWormLength*=1.07,i.test=s()):(a=d,m(),null===(u=i.test)||void 0===u||u.options.splice(a,1)))}}()}(t),d(),window.requestAnimationFrame(W)};w(),window.requestAnimationFrame(W)})();